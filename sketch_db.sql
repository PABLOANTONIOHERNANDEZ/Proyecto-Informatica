DROP DATABASE IF EXISTS DBPInf;
CREATE DATABASE DBPInf;
use DBPInf;

CREATE TABLE IF NOT EXISTS USUARIO (
	ID_USUARIO INT NOT NULL PRIMARY KEY auto_increment,
	NOMBRE VARCHAR(25) NOT NULL,
	APELLIDOS VARCHAR(25) NOT NULL,
    EMAIL VARCHAR(50) NOT NULL,
    PAIS VARCHAR(25) NOT NULL,
    LOCALIDAD VARCHAR(25) NOT NULL,
    DIRECCION VARCHAR(50) NOT NULL,
    TLF_MOVIL VARCHAR(9) NOT NULL,
	TLF_FIJO VARCHAR(9),	
    NOMBRE_USUARIO VARCHAR(25) NOT NULL,
    CONTRASENA_USUARIO VARCHAR(256) NOT NULL,
    SAL VARCHAR(11) NOT NULL
);

CREATE TABLE IF NOT EXISTS ASIGNACION (
	ID_ASIGNACION INT NOT NULL PRIMARY KEY auto_increment,
	ID_RESPONSABLE INT NOT NULL,
	ID_USUARIO INT NOT NULL,
    DESCRIPCION VARCHAR(25),
    FOREIGN KEY FK_RESPONSABLE1(ID_RESPONSABLE) REFERENCES USUARIO(ID_USUARIO),
    FOREIGN KEY FK_RESPONSABLE2(ID_USUARIO) REFERENCES USUARIO(ID_USUARIO)
);

CREATE TABLE IF NOT EXISTS ROL (
	ID_ROL INT NOT NULL PRIMARY KEY,
	NOMBRE VARCHAR(25) NOT NULL,
	DESCRIPCION VARCHAR(25)
);

/* Tabla relacion n:n entre usuario y rol */
CREATE TABLE IF NOT EXISTS ROLES (
	ID_USUARIO INT NOT NULL,
	ID_ROL INT NOT NULL,
    PRIMARY KEY (ID_USUARIO, ID_ROL),
    FOREIGN KEY FK_ROLES1(ID_USUARIO) REFERENCES USUARIO(ID_USUARIO),
    FOREIGN KEY FK_ROLES2(ID_ROL) REFERENCES ROL(ID_ROL)
);

CREATE TABLE IF NOT EXISTS MEDICIONES (
	ID_MEDICION INT NOT NULL PRIMARY KEY,
	ID_USUARIO INT NOT NULL,
	SENSOR VARCHAR(25) NOT NULL,
	MEDICION VARCHAR(25) NOT NULL,
    FOREIGN KEY FK_MEDICIONES(ID_USUARIO) REFERENCES USUARIO(ID_USUARIO)
);

CREATE TABLE IF NOT EXISTS ACCION (
	ID_ACCION INT NOT NULL PRIMARY KEY auto_increment,
	DESCRIPCION VARCHAR(25)
);

CREATE TABLE IF NOT EXISTS HISTORICO (
	ID_HISTORICO INT NOT NULL PRIMARY KEY auto_increment,
    ID_USUARIO INT NOT NULL,
	ID_ACCION INT NOT NULL,
	CAMBIO_ANTIGUO VARCHAR(50) NOT NULL,
	CAMBIO_NUEVO VARCHAR(50) NOT NULL,
    FOREIGN KEY FK_HISTORICO1(ID_USUARIO) REFERENCES USUARIO(ID_USUARIO),
    FOREIGN KEY FK_HISTORICO2(ID_ACCION) REFERENCES ACCION(ID_ACCION)
);